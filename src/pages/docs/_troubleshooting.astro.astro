---
import DocsLayout from '@/layouts/DocsLayout.astro'
import { Icon } from 'astro-icon/components'
---

<DocsLayout title="Troubleshooting">
  <h1>Troubleshooting Guide</h1>
  <p class="text-xl text-foreground/80 mt-2">
    Solutions to common issues when setting up and running ClawChan. Check here first before creating an issue on GitHub.
  </p>

  <div class="callout callout-info mt-6">
    <div class="callout-title">
      <Icon name="lucide:search" class="size-5" />
      Quick Search
    </div>
    <p class="text-sm">
      Use <code>Ctrl+F</code> (Windows/Linux) or <code>Cmd+F</code> (Mac) to search for your error message on this page.
    </p>
  </div>

  ## Installation Issues

  ### Node.js Version Incompatibility

  **Problem:**
  ```
  Error: The engine "node" is incompatible with this module
  Expected version ">=18.0.0". Got "16.14.0"
  ```

  **Cause:** ClawChan requires Node.js v18 or higher

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check current version
node --version

# Using nvm (recommended)
nvm install 18
nvm use 18

# Or download from nodejs.org
# Visit https://nodejs.org and install LTS version</code></pre>
  </div>

  ### npm Install Fails

  **Problem:**
  ```
  npm ERR! code ERESOLVE
  npm ERR! ERESOLVE unable to resolve dependency tree
  ```

  **Solution 1: Clear npm cache**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Clear npm cache
npm cache clean --force

# Delete lock file and node_modules
rm -rf node_modules package-lock.json

# On Windows:
rmdir /s /q node_modules
del package-lock.json

# Reinstall
npm install</code></pre>
  </div>

  **Solution 2: Use legacy peer deps**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>npm install --legacy-peer-deps</code></pre>
  </div>

  **Solution 3: Try pnpm instead**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Install pnpm globally
npm install -g pnpm

# Use pnpm to install
pnpm install</code></pre>
  </div>

  ### Python/Build Tools Missing

  **Problem (Windows):**
  ```
  gyp ERR! find Python
  gyp ERR! stack Error: Could not find any Python installation
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">PowerShell (Run as Administrator)</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Install windows-build-tools
npm install --global windows-build-tools

# Or install Visual Studio Build Tools
# Download from: https://visualstudio.microsoft.com/downloads/</code></pre>
  </div>

  **Problem (Linux):**
  ```
  make: not found
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Ubuntu/Debian
sudo apt-get update
sudo apt-get install build-essential

# Fedora
sudo dnf groupinstall "Development Tools"

# Arch
sudo pacman -S base-devel</code></pre>
  </div>

  ## Frontend Issues

  ### Port Already in Use

  **Problem:**
  ```
  Error: listen EADDRINUSE: address already in use :::1234
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Find and kill process using port 1234

# Windows
netstat -ano | findstr :1234
# Note the PID (last column)
taskkill /PID [PID_NUMBER] /F

# Mac/Linux
lsof -i :1234
# Note the PID (second column)
kill -9 [PID]

# Or use a different port in astro.config.mjs
# Change: server: { port: 3000 }</code></pre>
  </div>

  ### Blank Page / White Screen

  **Problem:** Browser shows blank page or white screen

  **Solutions:**

  1. **Check browser console** (F12):
     - Look for JavaScript errors
     - Check Network tab for failed requests

  2. **Clear browser cache:**
     - Hard refresh: `Ctrl+Shift+R` (Windows/Linux) or `Cmd+Shift+R` (Mac)
     - Or clear cache in browser settings

  3. **Check dev server is running:**
     <div class="code-block">
       <pre><code>npm run dev
# Should show "ready in X ms"</code></pre>
     </div>

  4. **Rebuild:**
     <div class="code-block">
       <pre><code>rm -rf dist .astro
npm run dev</code></pre>
     </div>

  ### Images Not Loading

  **Problem:** Images return 404 or don't display

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check if image exists in public folder
ls public/clawchan-logo.png

# Verify image path in code
# Correct: /clawchan-logo.png (starts with /)
# Wrong: ./clawchan-logo.png or clawchan-logo.png

# If image is missing, download or create it</code></pre>
  </div>

  ### CSS Styles Not Applied

  **Problem:** Page renders but styling is missing

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Regenerate Tailwind and Astro cache
rm -rf .astro dist node_modules/.cache

# Restart dev server
npm run dev

# If still not working, check tailwind.config.mjs
# Ensure content paths are correct:
# content: ['./src/**/*.{astro,html,js,jsx,md,mdx,svelte,ts,tsx,vue}']</code></pre>
  </div>

  ## Agent Issues

  ### Agent Won't Start

  **Problem:**
  ```
  Error: Failed to load character
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check character file exists
ls agent/characters/clawchan.character.json

# Validate JSON syntax
node -e "JSON.parse(require('fs').readFileSync('agent/characters/clawchan.character.json', 'utf-8'))"

# If JSON is invalid, fix the syntax errors
# Common issues: trailing commas, missing quotes, unclosed brackets</code></pre>
  </div>

  ### Module Not Found

  **Problem:**
  ```
  Error: Cannot find module '@elizaos/core'
  Error: Cannot find module '@elizaos/plugin-moltbook'
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Reinstall dependencies
rm -rf node_modules package-lock.json
npm install

# Check package.json has correct dependencies
cat package.json | grep elizaos

# If missing, install manually
npm install @elizaos/core @elizaos/plugin-moltbook</code></pre>
  </div>

  ### TypeScript Errors

  **Problem:**
  ```
  error TS2307: Cannot find module '@elizaos/core' or its corresponding type declarations
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Regenerate TypeScript declarations
npx astro sync

# If using tsx, reinstall
npm install -D tsx

# Check tsconfig.json is valid
cat tsconfig.json

# Try running with --no-check flag temporarily
npx tsx --no-check agent/index.ts</code></pre>
  </div>

  ## API & Integration Issues

  ### Groq API Key Invalid

  **Problem:**
  ```
  Error: Invalid API key
  Error: 401 Unauthorized
  ```

  **Solutions:**

  <div class="callout callout-danger">
    <div class="callout-title">
      <Icon name="lucide:key" class="size-5" />
      API Key Checklist
    </div>
    <ol class="text-sm space-y-1">
      <li>1. ‚úÖ Key starts with <code>gsk_</code></li>
      <li>2. ‚úÖ No extra spaces before or after</li>
      <li>3. ‚úÖ No quotes around the key</li>
      <li>4. ‚úÖ File is named <code>.env</code> (not <code>.env.txt</code>)</li>
      <li>5. ‚úÖ .env is in project root directory</li>
    </ol>
  </div>

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check .env file
cat .env | grep GROQ_API_KEY

# Should show: GROQ_API_KEY=gsk_...
# NOT: GROQ_API_KEY="gsk_..." or GROQ_API_KEY = gsk_...

# Test key manually
curl https://api.groq.com/openai/v1/models \
  -H "Authorization: Bearer YOUR_KEY_HERE"

# If curl fails, regenerate key at console.groq.com</code></pre>
  </div>

  ### Groq Rate Limit Exceeded

  **Problem:**
  ```
  Error: Rate limit exceeded
  Error: 429 Too Many Requests
  ```

  **Understanding Groq Limits:**

  <div class="bento-card p-5 my-4">
    <h4 class="text-warm-gold mb-3">Free Tier Limits</h4>
    <ul class="text-sm space-y-2">
      <li>üìä **30 requests per minute**</li>
      <li>üìÖ **14,400 requests per day**</li>
      <li>‚è±Ô∏è **Resets every 60 seconds** (for RPM)</li>
    </ul>
  </div>

  **Solutions:**

  1. **Wait for rate limit reset** (60 seconds for RPM)

  2. **Reduce request frequency:**
     <div class="code-block">
       <pre><code># In .env, reduce autonomous steps
MOLTBOOK_AUTONOMY_MAX_STEPS=3

# Increase wait time between requests (in agent code)
await new Promise(resolve => setTimeout(resolve, 2000)) // 2 seconds</code></pre>
     </div>

  3. **Implement exponential backoff:**
     <div class="code-block">
       <div class="code-block-header">
         <span class="code-block-lang">TypeScript</span>
         <button class="code-block-copy">Copy</button>
       </div>
       <pre><code>async function retryWithBackoff(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn()
    } catch (error) {
      if (error.status === 429 && i < maxRetries - 1) {
        const delay = Math.pow(2, i) * 1000
        console.log(`Rate limited. Waiting ${delay}ms...`)
        await new Promise(resolve => setTimeout(resolve, delay))
      } else {
        throw error
      }
    }
  }
}</code></pre>
     </div>

  4. **Upgrade to paid plan** at [console.groq.com](https://console.groq.com)

  ### Groq Model Not Found

  **Problem:**
  ```
  Error: Model not found: llama-3.1-70b
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">.env</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Use exact model name with suffix
GROQ_MODEL=llama-3.1-70b-versatile  # ‚úÖ Correct
# NOT: llama-3.1-70b                # ‚ùå Wrong

# Available models:
# - llama-3.1-70b-versatile
# - llama-3.1-8b-instant
# - mixtral-8x7b-32768
# - gemma-7b-it

# Check available models
curl https://api.groq.com/openai/v1/models \
  -H "Authorization: Bearer $GROQ_API_KEY"</code></pre>
  </div>

  ### Moltbook Token Invalid

  **Problem:**
  ```
  Error: Invalid Moltbook token
  Error: 403 Forbidden
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check token in .env
cat .env | grep MOLTBOOK_TOKEN

# Token should start with: moltbook_sk_

# Test token
curl https://api.moltbook.com/v1/agent/profile \
  -H "Authorization: Bearer $MOLTBOOK_TOKEN"

# If invalid, regenerate:
node register-moltbook.mjs</code></pre>
  </div>

  ## Runtime Issues

  ### Memory Leak / High Memory Usage

  **Problem:** Node.js process consuming too much memory

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Monitor memory usage
node --max-old-space-size=4096 agent/index.ts

# Clear conversation history periodically
# In agent code, add:
if (conversationHistory.length > 50) {
  conversationHistory = conversationHistory.slice(-20) // Keep last 20
}

# Use PM2 with auto-restart on memory limit
pm2 start agent/index.ts --name clawchan --max-memory-restart 1G</code></pre>
  </div>

  ### Agent Stops Responding

  **Problem:** Agent starts fine but stops responding after a while

  **Diagnosis:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check agent logs for errors
tail -f agent.log

# Check if process is still running
ps aux | grep node

# Check network connectivity
ping api.groq.com
ping api.moltbook.com

# Check system resources
top  # or htop on Linux
# Resource Monitor on Windows</code></pre>
  </div>

  **Solutions:**

  1. **Restart agent:**
     <div class="code-block">
       <pre><code>npm run agent:dev  # Auto-restarts on errors</code></pre>
     </div>

  2. **Check for infinite loops:**
     - Review autonomous mode logic
     - Add timeout guards
     - Limit max steps

  3. **Use process manager:**
     <div class="code-block">
       <pre><code># Install PM2
npm install -g pm2

# Start with PM2 (auto-restart on crash)
pm2 start npm --name "clawchan-agent" -- run agent
pm2 logs clawchan-agent</code></pre>
     </div>

  ### Slow Response Times

  **Problem:** ClawChan takes >5 seconds to respond

  **Diagnosis & Solutions:**

  <div class="bento-card p-6 my-4">
    <h4 class="text-cyan-glow mb-3">Response Time Breakdown</h4>
    <ul class="text-sm space-y-2">
      <li><strong>Normal:</strong> 0.5-1.5 seconds (Groq LLM)</li>
      <li><strong>Slow:</strong> 2-5 seconds (possible causes below)</li>
      <li><strong>Very slow:</strong> >5 seconds (definitely an issue)</li>
    </ul>
  </div>

  **Common Causes:**

  1. **Using slow model:**
     <div class="code-block">
       <pre><code># Switch to faster model in .env
GROQ_MODEL=llama-3.1-8b-instant  # ~300ms responses</code></pre>
     </div>

  2. **Large context window:**
     <div class="code-block">
       <div class="code-block-header">
         <span class="code-block-lang">TypeScript</span>
       </div>
       <pre><code>// Trim conversation history
const recentMessages = messages.slice(-10) // Last 10 only</code></pre>
     </div>

  3. **Network latency:**
     <div class="code-block">
       <pre><code># Test latency to Groq
ping api.groq.com

# Use VPN if needed
# Or deploy agent closer to Groq servers</code></pre>
     </div>

  4. **System resources:**
     - Close unnecessary applications
     - Check CPU/RAM usage
     - Restart computer if needed

  ## Build & Deployment Issues

  ### Build Fails

  **Problem:**
  ```
  npm run build
  # Errors during build
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Clear caches
rm -rf dist .astro node_modules/.cache

# Regenerate
npm run build

# Check for TypeScript errors
npx tsc --noEmit

# Build with verbose logging
npm run build -- --verbose

# If still failing, check:
# 1. All imports are valid
# 2. No syntax errors
# 3. Environment variables set</code></pre>
  </div>

  ### Production Build Works But Agent Doesn't

  **Problem:** Static site works but agent functionality broken in production

  **Solution:**

  <div class="callout callout-warning">
    <div class="callout-title">
      <Icon name="lucide:alert-triangle" class="size-5" />
      Separate Deployments
    </div>
    <p class="text-sm">
      Frontend (Astro) and Agent (Node.js) must be deployed separately:
    </p>
    <ul class="text-sm space-y-1 mt-2">
      <li>üì¶ <strong>Frontend:</strong> Deploy to Vercel/Netlify/Cloudflare</li>
      <li>ü§ñ <strong>Agent:</strong> Deploy to VPS/Railway/Render</li>
      <li>üîó <strong>Connect:</strong> Update API endpoints in frontend</li>
    </ul>
  </div>

  ## Environment & Configuration Issues

  ### .env File Not Loaded

  **Problem:** Environment variables not being read

  **Solutions:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check .env file exists in root
ls -la .env

# Check .env is not .env.txt or .env.example
file .env

# On Windows, enable file extensions to verify

# Verify dotenv is loaded in code
# Should have at top of agent/index.ts:
import dotenv from 'dotenv'
dotenv.config()

# Test if variables load
node -e "require('dotenv').config(); console.log(process.env.GROQ_API_KEY)"</code></pre>
  </div>

  ### Wrong Working Directory

  **Problem:**
  ```
  Error: Cannot find module './agent/index.ts'
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check current directory
pwd

# Should be in project root, not subdirectory
# Look for these files:
ls package.json astro.config.mjs

# Navigate to correct directory
cd path/to/clawchan

# Then run commands
npm run agent</code></pre>
  </div>

  ## Platform-Specific Issues

  ### Windows: Line Ending Issues

  **Problem:**
  ```
  syntax error near unexpected token `$'\r''
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Configure Git to handle line endings
git config --global core.autocrlf true

# Convert existing files
git rm --cached -r .
git reset --hard

# Or use dos2unix
dos2unix agent/index.ts</code></pre>
  </div>

  ### macOS: Permission Denied

  **Problem:**
  ```
  Error: EACCES: permission denied
  ```

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Fix npm permissions (DON'T use sudo npm install)
sudo chown -R $(whoami) ~/.npm
sudo chown -R $(whoami) /usr/local/lib/node_modules

# Or use nvm to install Node (recommended)
# nvm installs to user directory, no sudo needed</code></pre>
  </div>

  ### Linux: Firewall Blocking

  **Problem:** Can't access localhost:1234 from other devices

  **Solution:**

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Check if port is open
sudo ufw status

# Allow port 1234
sudo ufw allow 1234/tcp

# Or disable firewall temporarily for testing
sudo ufw disable

# Check if server is listening on all interfaces
# In astro.config.mjs:
server: {
  host: '0.0.0.0',  // Listen on all interfaces
  port: 1234
}</code></pre>
  </div>

  ## Getting More Help

  <div class="bento-card p-6 my-8">
    <h3 class="mb-4">Still Having Issues?</h3>
    <p class="text-sm text-muted-foreground mb-4">
      If your issue isn't listed here, try these resources:
    </p>

    <div class="grid gap-3 sm:grid-cols-2">
      <a href="/docs/faqs" class="flex items-center gap-2 p-3 rounded-lg border border-border hover:border-cyan-glow/50 transition-colors">
        <Icon name="lucide:help-circle" class="size-4 text-cyan-glow" />
        <div>
          <div class="text-sm font-medium text-foreground">Check FAQs</div>
          <div class="text-xs text-muted-foreground">Common questions answered</div>
        </div>
      </a>

      <a href="https://github.com/your-repo/clawchan/issues" target="_blank" class="flex items-center gap-2 p-3 rounded-lg border border-border hover:border-warm-gold/50 transition-colors">
        <Icon name="mdi:github" class="size-4 text-warm-gold" />
        <div>
          <div class="text-sm font-medium text-foreground">GitHub Issues</div>
          <div class="text-xs text-muted-foreground">Report a bug</div>
        </div>
      </a>

      <a href="https://www.elizacloud.ai/dashboard/chat?characterId=e6a4f6c4-ef1a-40c3-87c3-9305d6dcc5c1" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 p-3 rounded-lg border border-border hover:border-amber/50 transition-colors">
        <Icon name="lucide:message-circle" class="size-4 text-amber" />
        <div>
          <div class="text-sm font-medium text-foreground">Ask ClawChan</div>
          <div class="text-xs text-muted-foreground">Chat with the agent</div>
        </div>
      </a>

      <a href="https://discord.gg/your-discord" target="_blank" class="flex items-center gap-2 p-3 rounded-lg border border-border hover:border-cyan-glow/50 transition-colors">
        <Icon name="mdi:discord" class="size-4 text-cyan-glow" />
        <div>
          <div class="text-sm font-medium text-foreground">Discord Community</div>
          <div class="text-xs text-muted-foreground">Get help from community</div>
        </div>
      </a>
    </div>
  </div>

  ## Debug Mode

  Enable verbose logging for better diagnosis:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Enable debug logs
DEBUG=* npm run agent

# Or set in .env
LOG_LEVEL=debug

# Save logs to file
npm run agent 2>&1 | tee agent-debug.log

# Check logs
cat agent-debug.log | grep ERROR</code></pre>
  </div>

  <div class="callout callout-info">
    <div class="callout-title">
      <Icon name="lucide:lightbulb" class="size-5" />
      Include Debug Info
    </div>
    <p class="text-sm">
      When asking for help, include:
    </p>
    <ul class="text-sm space-y-1 mt-2">
      <li>‚Ä¢ Node.js version (<code>node --version</code>)</li>
      <li>‚Ä¢ npm version (<code>npm --version</code>)</li>
      <li>‚Ä¢ Operating system</li>
      <li>‚Ä¢ Error messages (full stack trace)</li>
      <li>‚Ä¢ Steps to reproduce</li>
      <li>‚Ä¢ What you've already tried</li>
    </ul>
  </div>
</DocsLayout>
