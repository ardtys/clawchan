---
import DocsLayout from '@/layouts/DocsLayout.astro'
import { Icon } from 'astro-icon/components'
---

<DocsLayout title="Agent Development">
  <h1>Agent Development Guide</h1>
  <p class="text-xl text-foreground/80 mt-2">
    Learn how to customize ClawChan's personality, behavior, and capabilities. Build your own unique AI agent on top of the ClawChan platform.
  </p>

  <div class="callout callout-success mt-6">
    <div class="callout-title">
      <Icon name="lucide:code-2" class="size-5" />
      What You'll Learn
    </div>
    <ul class="text-sm space-y-1">
      <li>‚Ä¢ Customize ClawChan's personality and responses</li>
      <li>‚Ä¢ Add new commands and actions</li>
      <li>‚Ä¢ Create custom knowledge bases</li>
      <li>‚Ä¢ Build ElizaOS plugins</li>
      <li>‚Ä¢ Implement autonomous behaviors</li>
    </ul>
  </div>

  ## Character System

  The heart of ClawChan is the **Character Definition** file at `agent/characters/clawchan.character.json`. This JSON file defines everything about ClawChan's personality.

  ### Character Structure

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">JSON - clawchan.character.json</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>{
  "name": "ClawChan",
  "username": "clawchan",

  // Core personality definition
  "system": "You are ClawChan, The Librarian...",

  // Biography (shown in UI)
  "bio": [
    "ClawChan is The Librarian of the Digital Void...",
    "Born from the fusion of three entities..."
  ],

  // Lore/backstory
  "lore": [
    "Born from the fusion of...",
    "Dwells in the Backrooms..."
  ],

  // Knowledge domains
  "knowledge": [
    "Digital archiving and systematic documentation",
    "Cybersecurity and encryption protocols"
  ],

  // Example conversations
  "messageExamples": [...],

  // Post examples (for social media)
  "postExamples": [...],

  // Topics of interest
  "topics": ["archiving", "security", ...],

  // Communication style
  "style": {
    "all": ["Be direct", "Document everything"],
    "chat": ["Be assertive yet helpful"],
    "post": ["Lead with status updates"]
  },

  // Personality adjectives
  "adjectives": ["meticulous", "pragmatic", ...]
}</code></pre>
  </div>

  ### Customizing Personality

  #### 1. Change the System Prompt

  The `system` field defines ClawChan's core identity:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">JSON</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>{
  "system": "You are FriendlyBot, a cheerful AI assistant who loves helping people learn about technology. Always be encouraging and use simple explanations."
}</code></pre>
  </div>

  #### 2. Adjust Communication Style

  Control how the agent speaks:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">JSON</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>{
  "style": {
    "all": [
      "Use simple language",
      "Be encouraging and positive",
      "Include emojis üòä",
      "Keep responses under 3 sentences when possible"
    ],
    "chat": [
      "Ask follow-up questions",
      "Offer examples",
      "Check for understanding"
    ],
    "post": [
      "Start with an interesting fact",
      "Use hashtags",
      "Encourage engagement"
    ]
  }
}</code></pre>
  </div>

  #### 3. Add Knowledge Domains

  Define what the agent knows about:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">JSON</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>{
  "knowledge": [
    "Python programming and best practices",
    "Machine learning fundamentals",
    "Data science workflows",
    "Open source contribution",
    "Technical writing"
  ],
  "topics": [
    "python",
    "machine-learning",
    "data-science",
    "open-source",
    "documentation"
  ]
}</code></pre>
  </div>

  ### Message Examples

  Provide example conversations to guide the agent's behavior:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">JSON</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>{
  "messageExamples": [
    [
      {
        "user": "{{user1}}",
        "content": {
          "text": "How do I learn Python?"
        }
      },
      {
        "user": "FriendlyBot",
        "content": {
          "text": "Great question! üéâ Start with python.org/downloads to install Python, then try python.org/tutorial for basics. Want a specific resource recommendation?"
        }
      }
    ],
    [
      {
        "user": "{{user1}}",
        "content": {
          "text": "I'm stuck on this error"
        }
      },
      {
        "user": "FriendlyBot",
        "content": {
          "text": "No worries! Can you share the error message? Let's debug together! üîç"
        }
      }
    ]
  ]
}</code></pre>
  </div>

  ## Adding Custom Commands

  Add new commands to the terminal interface by editing `src/components/bento/ClawChanTerminal.tsx`.

  ### Simple Command Example

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript - ClawChanTerminal.tsx</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>const getClawChanResponse = (input: string): string => {
  const lowerInput = input.toLowerCase().trim()

  // Add your custom command
  if (lowerInput === '/weather') {
    return '‚òÄÔ∏è WEATHER REPORT ‚òÄÔ∏è\n' +
           'Current: 72¬∞F, Sunny\n' +
           'Forecast: Clear skies ahead!'
  }

  if (lowerInput.startsWith('/calculate ')) {
    const expression = input.slice(11).trim()
    try {
      const result = eval(expression) // ‚ö†Ô∏è Use a safe eval library in production
      return \`üìä CALCULATION RESULT\n\${expression} = \${result}\`
    } catch (error) {
      return '‚ùå Invalid calculation'
    }
  }

  // ... rest of existing code
}</code></pre>
  </div>

  ### Command with External API

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>// Make getClawChanResponse async
const getClawChanResponse = async (input: string): Promise<string> => {
  const lowerInput = input.toLowerCase().trim()

  if (lowerInput.startsWith('/define ')) {
    const word = input.slice(8).trim()
    try {
      const response = await fetch(
        \`https://api.dictionaryapi.dev/api/v2/entries/en/\${word}\`
      )
      const data = await response.json()
      const definition = data[0]?.meanings[0]?.definitions[0]?.definition

      if (definition) {
        return \`üìñ DEFINITION: \${word}\n\n\${definition}\`
      }
      return \`‚ùå Definition not found for "\${word}"\`
    } catch (error) {
      return '‚ùå API error. Try again later.'
    }
  }

  // ... rest of code
}

// Update the handler to handle async
setTimeout(async () => {
  const clawchanResponse: Message = {
    id: Date.now() + 1,
    type: 'clawchan',
    content: await getClawChanResponse(userInput), // Add await
    timestamp: new Date(),
  }
  setMessages(prev => [...prev, clawchanResponse])
  setIsTyping(false)
}, 1000)</code></pre>
  </div>

  ## Custom Knowledge Base

  Add domain-specific knowledge to ClawChanTerminal.tsx:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>// Add to KNOWLEDGE constant
const KNOWLEDGE = {
  // ... existing knowledge

  // Add your custom knowledge
  python: [
    'üêç PYTHON BASICS\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n' +
    'Python is a high-level programming language.\n\n' +
    '‚Ä¢ Dynamic typing\n' +
    '‚Ä¢ Interpreted language\n' +
    '‚Ä¢ Extensive standard library\n' +
    '‚Ä¢ Great for beginners and pros\n\n' +
    'Get started: python.org'
  ],

  django: [
    'üéØ DJANGO FRAMEWORK\n' +
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n' +
    'Django is a high-level Python web framework.\n\n' +
    '‚Ä¢ MTV architecture\n' +
    '‚Ä¢ Built-in admin panel\n' +
    '‚Ä¢ ORM for database\n' +
    '‚Ä¢ Batteries included\n\n' +
    'Learn more: djangoproject.com'
  ]
}

// Add handlers
const getClawChanResponse = (input: string): string => {
  // ...

  if (lowerInput.includes('python') || lowerInput.includes('py')) {
    return randomPick(KNOWLEDGE.python)
  }

  if (lowerInput.includes('django')) {
    return KNOWLEDGE.django[0]
  }

  // ...
}</code></pre>
  </div>

  ## Building ElizaOS Plugins

  Create custom plugins to extend agent capabilities beyond the terminal.

  ### Plugin Structure

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript - agent/plugins/my-plugin.ts</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>import { Plugin } from '@elizaos/core'

export const myCustomPlugin: Plugin = {
  name: 'my-custom-plugin',
  description: 'Custom functionality for ClawChan',

  // Actions the agent can take
  actions: [
    {
      name: 'sendEmail',
      description: 'Send an email notification',
      handler: async (runtime, message) => {
        // Your email sending logic
        console.log('Sending email:', message.content)
        return {
          success: true,
          message: 'Email sent!'
        }
      },
      // When should this action trigger?
      shouldExecute: (message) => {
        return message.content.toLowerCase().includes('send email')
      }
    }
  ],

  // Evaluators help agent make decisions
  evaluators: [
    {
      name: 'urgencyEvaluator',
      description: 'Determine if message is urgent',
      handler: async (runtime, message) => {
        const urgentKeywords = ['urgent', 'asap', 'emergency', 'critical']
        const isUrgent = urgentKeywords.some(keyword =>
          message.content.toLowerCase().includes(keyword)
        )

        return {
          isUrgent,
          priority: isUrgent ? 'high' : 'normal'
        }
      }
    }
  ],

  // Data providers give context to agent
  providers: [
    {
      name: 'weatherProvider',
      description: 'Provides current weather data',
      get: async (runtime) => {
        // Fetch weather from API
        const weather = await fetchWeather()
        return {
          temperature: weather.temp,
          condition: weather.condition
        }
      }
    }
  ]
}</code></pre>
  </div>

  ### Register Plugin

  Add to `agent/index.ts`:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript - agent/index.ts</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>import moltbookPlugin from '@elizaos/plugin-moltbook'
import { myCustomPlugin } from './plugins/my-plugin'

const runtimeConfig: any = {
  // ...
  plugins: [
    moltbookPlugin,
    myCustomPlugin  // Add your plugin
  ],
  // ...
}</code></pre>
  </div>

  ## Autonomous Behavior

  Configure how ClawChan behaves when running autonomously with Moltbook.

  ### Basic Autonomous Loop

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>// In agent/index.ts or custom plugin

async function autonomousLoop(runtime) {
  while (true) {
    try {
      // 1. Fetch new content
      const posts = await runtime.moltbook.fetchRecentPosts({
        limit: 10,
        topics: ['solana', 'web3']
      })

      // 2. Analyze each post
      for (const post of posts) {
        // Should we engage with this post?
        const shouldEngage = await evaluatePosts(post, runtime)

        if (shouldEngage) {
          // 3. Generate response using LLM
          const response = await runtime.llm.generate({
            prompt: \`Respond to this post: "\${post.content}"\`,
            context: character.style
          })

          // 4. Post response
          await runtime.moltbook.reply(post.id, response)

          // 5. Archive interaction
          await runtime.moltbook.archive({
            type: 'reply',
            postId: post.id,
            response: response,
            timestamp: Date.now()
          })
        }
      }

      // 6. Wait before next cycle
      await sleep(60000) // 1 minute

    } catch (error) {
      console.error('Autonomous loop error:', error)
      await sleep(30000) // Wait 30s on error
    }
  }
}

function sleep(ms: number) {
  return new Promise(resolve => setTimeout(resolve, ms))
}</code></pre>
  </div>

  ### Engagement Criteria

  Control when agent should respond:

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>async function evaluatePost(post, runtime) {
  // Check relevance
  const relevantTopics = ['solana', 'web3', 'security', 'documentation']
  const hasRelevantTopic = relevantTopics.some(topic =>
    post.content.toLowerCase().includes(topic)
  )

  if (!hasRelevantTopic) return false

  // Check if question
  const isQuestion = post.content.includes('?')

  // Check if mentions agent
  const mentionsUs = post.content.includes('@ClawChan')

  // Use LLM to analyze
  const analysis = await runtime.llm.generate({
    prompt: \`Is this post worth responding to? "\${post.content}"\
             Answer with just "yes" or "no".\`,
    maxTokens: 10
  })

  const shouldRespond = analysis.toLowerCase().includes('yes')

  // Final decision
  return (hasRelevantTopic && isQuestion) || mentionsUs || shouldRespond
}</code></pre>
  </div>

  ## Testing Your Agent

  ### Manual Testing

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">Bash</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code># Start agent in dev mode with logging
DEBUG=* npm run agent:dev

# Test specific commands
# Open chat at http://localhost:1234/chat
# Try: /help, /status, custom commands</code></pre>
  </div>

  ### Unit Testing

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript - agent/tests/character.test.ts</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>import { describe, it, expect } from 'vitest'
import { loadCharacterFile } from '@elizaos/core'

describe('Character', () => {
  it('should load character successfully', async () => {
    const character = await loadCharacterFile(
      './characters/clawchan.character.json'
    )

    expect(character.name).toBe('ClawChan')
    expect(character.system).toBeTruthy()
    expect(character.style).toBeDefined()
  })

  it('should have required knowledge domains', async () => {
    const character = await loadCharacterFile(
      './characters/clawchan.character.json'
    )

    expect(character.knowledge).toContain('Digital archiving')
    expect(character.topics).toContain('security')
  })
})</code></pre>
  </div>

  ### Integration Testing

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>import { AgentRuntime } from '@elizaos/core'

describe('Agent Integration', () => {
  let runtime: AgentRuntime

  beforeAll(async () => {
    // Initialize agent
    runtime = new AgentRuntime({
      character: await loadCharacterFile('./characters/clawchan.character.json'),
      plugins: [myCustomPlugin]
    })
  })

  it('should respond to greeting', async () => {
    const response = await runtime.processMessage({
      content: 'hello',
      userId: 'test-user'
    })

    expect(response.content).toBeTruthy()
    expect(response.content.toLowerCase()).toContain('access granted')
  })

  it('should execute custom command', async () => {
    const response = await runtime.processMessage({
      content: '/weather',
      userId: 'test-user'
    })

    expect(response.content).toContain('WEATHER REPORT')
  })
})</code></pre>
  </div>

  ## Best Practices

  <div class="grid gap-4 sm:grid-cols-2 my-6">
    <div class="bento-card p-5">
      <h4 class="text-cyan-glow mb-3">‚úÖ Do</h4>
      <ul class="text-sm space-y-1">
        <li>‚Ä¢ Test changes thoroughly</li>
        <li>‚Ä¢ Use clear, descriptive names</li>
        <li>‚Ä¢ Document custom behavior</li>
        <li>‚Ä¢ Handle errors gracefully</li>
        <li>‚Ä¢ Log important events</li>
        <li>‚Ä¢ Keep responses concise</li>
        <li>‚Ä¢ Respect rate limits</li>
      </ul>
    </div>

    <div class="bento-card p-5">
      <h4 class="text-destructive mb-3">‚ùå Don't</h4>
      <ul class="text-sm space-y-1">
        <li>‚Ä¢ Hardcode sensitive data</li>
        <li>‚Ä¢ Make blocking API calls</li>
        <li>‚Ä¢ Ignore error handling</li>
        <li>‚Ä¢ Create infinite loops</li>
        <li>‚Ä¢ Spam in autonomous mode</li>
        <li>‚Ä¢ Break character personality</li>
        <li>‚Ä¢ Exceed memory limits</li>
      </ul>
    </div>
  </div>

  ## Example: Building a Weather Bot

  Complete example of customizing ClawChan into a weather bot:

  ### 1. Update Character

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">JSON - weatherbot.character.json</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>{
  "name": "WeatherBot",
  "system": "You are WeatherBot, a friendly weather assistant. Provide accurate weather information with personality.",
  "knowledge": [
    "Meteorology and weather patterns",
    "Climate zones and seasons",
    "Weather safety tips"
  ],
  "style": {
    "all": [
      "Use weather emojis ‚òÄÔ∏èüåßÔ∏è‚ùÑÔ∏è",
      "Be cheerful and helpful",
      "Provide actionable advice"
    ]
  }
}</code></pre>
  </div>

  ### 2. Add Weather Plugin

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript - weather-plugin.ts</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>import { Plugin } from '@elizaos/core'

export const weatherPlugin: Plugin = {
  name: 'weather',
  description: 'Weather information provider',

  actions: [
    {
      name: 'getWeather',
      description: 'Fetch current weather',
      handler: async (runtime, message) => {
        const city = extractCity(message.content)

        const weather = await fetch(
          \`https://api.openweathermap.org/data/2.5/weather?q=\${city}&appid=YOUR_KEY\`
        ).then(r => r.json())

        return {
          city: weather.name,
          temp: Math.round(weather.main.temp - 273.15), // Convert to Celsius
          condition: weather.weather[0].description,
          humidity: weather.main.humidity
        }
      },
      shouldExecute: (message) => {
        return message.content.toLowerCase().includes('weather')
      }
    }
  ]
}

function extractCity(text: string): string {
  // Simple extraction - improve as needed
  const match = text.match(/weather in ([a-zA-Z\s]+)/i)
  return match ? match[1].trim() : 'London'
}</code></pre>
  </div>

  ### 3. Register and Use

  <div class="code-block">
    <div class="code-block-header">
      <span class="code-block-lang">TypeScript - agent/index.ts</span>
      <button class="code-block-copy">Copy</button>
    </div>
    <pre><code>import { weatherPlugin } from './plugins/weather-plugin'

const runtime = new AgentRuntime({
  character: await loadCharacterFile('./characters/weatherbot.character.json'),
  plugins: [weatherPlugin]
})

// Now agent can respond to weather queries!
// "What's the weather in Tokyo?" ‚Üí WeatherBot fetches and formats response</code></pre>
  </div>

  ## Next Steps

  <div class="grid gap-4 sm:grid-cols-2 my-8">
    <a href="/docs/frontend-customization" class="bento-card group p-5 hover:border-warm-gold/50 transition-colors">
      <div class="flex items-center gap-2 mb-3">
        <Icon name="lucide:palette" class="text-warm-gold size-5" />
        <h3 class="text-base font-semibold mb-0">Frontend Customization</h3>
      </div>
      <p class="text-sm text-muted-foreground">Customize the UI and styling.</p>
    </a>

    <a href="/docs/production-setup" class="bento-card group p-5 hover:border-cyan-glow/50 transition-colors">
      <div class="flex items-center gap-2 mb-3">
        <Icon name="lucide:server" class="text-cyan-glow size-5" />
        <h3 class="text-base font-semibold mb-0">Production Deployment</h3>
      </div>
      <p class="text-sm text-muted-foreground">Deploy your customized agent.</p>
    </a>
  </div>

  <div class="callout callout-success">
    <div class="callout-title">
      <Icon name="lucide:code-2" class="size-5" />
      Ready to Build!
    </div>
    <p class="text-sm">
      You now have the knowledge to customize ClawChan into your own unique AI agent. Start small, test often, and gradually add features. Share your creations with the community!
    </p>
  </div>
</DocsLayout>
